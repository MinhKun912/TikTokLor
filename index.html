<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <script src="modal/Avatar.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">


</head>
<body>
<nav class="navbar">
    <div class="nav-left"><h1>tiktokLỏ</h1>
        <ul class="navlogo">
            <li><i class="bi bi-bell-fill"></i></li>
            <li><i class="bi bi-chat-heart-fill"></i></li>
            <li><i class="bi bi-bookmark-plus-fill"></i></li>
        </ul>
    </div>
    <div class="nav-right">
        <div class="search-box">
            <img src="images/search.png" alt="">
            <input type="text" placeholder="Search">
        </div>
        <div id="postAvatar"></div>
        <!--        nut dang ky dang nhap-->
        <div id="action">
            <button onclick="dieuHuong()" class="logSign">Sign Up</button>
            <button onclick="dieuHuonglog()" class="logSign">Sign In</button>

        </div>
        <button onclick="chuyenHuong()" id="currentUser"></button>
        <button id="out" onclick="logout()">LOG OUT</button>
    </div>

</nav>

<div id="profile">
    <!--=========profile================-->

    <div class="upload-btn-wrapper">
        <input type="file" value="upload" name="myfile" id="fileButton">
        <button class="btn">Chose</button>

    </div>
    <div class="themBtn">
        <input id="conten" placeholder="Write here!">
        <button onclick="creatPost()">ADD</button>
        <br>
        <progress value="0" max="100" id="uploader">0%</progress>
        <br>

    </div>


    <!--COntaine-->
    <div id="divFather">
        <div id="div1">
            <div class="rows">
                <div>
                    <h1><i class="bi bi-house-door"></i>Dành cho bạn</h1>
                    <h1><i class="bi bi-person-badge"></i>Đang follow</h1>
                    <h1><i class="bi bi-camera-reels"></i>Live Sờ Trim</h1>
                    <hr>
                </div>

                <div class="dexuat">
                    <h2>Nổi bật<i class="bi bi-fire"></i></h2>
                    <div class="person"><img src="/images/member-4.png" alt="">
                        <p>alexSander</p></div>
                    <div class="person"><img src="/images/member-9.png" alt="">
                        <p>Yua Mikami</p></div>
                    <div class="person"><img src="/images/member-5.png" alt="">
                        <p>Maria ozawa</p></div>
                    <div class="person"><img src="/images/member-6.png" alt="">
                        <p>Tokuda sama</p></div>
                    <a style="text-decoration: none" href="">Xem tất cả</a>
                    <hr>
                </div>

                <div class="dangfolow">
                    <div class="person"><img src="/images/member-9.png" alt="">
                        <p>Minh Sama</p></div>
                    <div class="person"><img src="/images/member-2.png" alt="">
                        <p>Yua kimchi</p></div>
                    <div class="person"><img src="/images/member-3.png" alt="">
                        <p>Tili ozawa</p></div>
                    <div class="person"><img src="/images/member-4.png" alt="">
                        <p>Áner sama</p></div>
                    <a style="text-decoration: none" href="">Xem tất cả</a>
                </div>

            </div>
        </div>
        <div id="content"></div>
        <div id="div2">
            <div class="rows">
                <p>News</p>
                <div class="draw">
                    <h2>Soi Sáng Kiến Thức Giới trẻ</h2>
                </div>
            </div>
        </div>
    </div>

</div>
</body>
<script src="modal/post.js"></script>

<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>

<script type='text/javascript'> ! function (e, t, a) { function n() { c( ".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}" ), o(), r() } function r() { for (var e = 0; e < d.length; e++) d[e].alpha <= 0 ? (t.body.removeChild(d[e].el), d.splice(e, 1)) : (d[e].y--, d[e].scale += .004, d[e].alpha -= .013, d[e].el.style.cssText = "left:" + d[e].x + "px;top:" + d[e].y + "px;opacity:" + d[e].alpha + ";transform:scale(" + d[e].scale + "," + d[e].scale + ") rotate(45deg);background:" + d[e].color + ";z-index:99999"); requestAnimationFrame(r) } function o() { var t = "function" == typeof e.onclick && e.onclick; e.onclick = function (e) { t && t(), i(e) } } function i(e) { var a = t.createElement("div"); a.className = "heart", d.push({ el: a, x: e.clientX - 5, y: e.clientY - 5, scale: 1, alpha: 1, color: s() }), t.body.appendChild(a) } function c(e) { var a = t.createElement("style"); a.type = "text/css"; try { a.appendChild(t.createTextNode(e)) } catch (t) { a.styleSheet.cssText = e } t.getElementsByTagName("head")[0].appendChild(a) } function s() { return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")" } var d = []; e.requestAnimationFrame = function () { return e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) { setTimeout(e, 1e3 / 60) } }(), n() }(window, document); </script>

<script>
    // dang nhap display
    let currentUser = localStorage.getItem("nameKey")
    let idUser = localStorage.getItem("idKey")

    if (currentUser) {
        document.getElementById("currentUser").innerText = currentUser + '';
        document.getElementById('action').style.display = "none";
    } else {
        document.getElementById("currentUser").style.display = "none";
        document.getElementById('profile').style.display = 'none';
        document.getElementById('out').style.display = 'none';
        document.getElementById('postAvatar').style.display = 'none'

    }

    function logout() {
        localStorage.removeItem("nameKey")
        localStorage.removeItem("idKey")
        location.href = "index.html"
    }

    let listUser = JSON.parse(localStorage.getItem("list_user"));
    if (listUser == null) {
        listUser = []
    }
    let listPost = JSON.parse(localStorage.getItem('list_video'));
    if (listPost == null) {
        listPost = [];
    }

    function findUserbyId(id) {
        for (let i = 0; i < listUser.length; i++) {
            if (listUser[i].id == id) {
                return listUser[i]
            }
        }
        return null;

    }

    function showListPost() {
        let drawPost = '';
        for (let i = 0; i < listPost.length; i++) {
            let darwCM = '';
            for (let j = 0; j < listPost[i].listCM.length; j++) {
                darwCM += `<div>${listPost[i].listCM[j].user} ${listPost[i].listCM[j].contentCM}</div>`
            }
            drawPost += `<div class="card" >${findUserbyId(listPost[i].idUser).name} Đã đăng bài:<br/>${listPost[i].title}
<div><video width="320" height="240" controls>
  <source src="${listPost[i].imgPost}" type="video/mp4"></video></div>

<div class="coment">${darwCM}</div>
<input placeholder="Viết comment vào đây"  class="cmt-btn" type="text" id="comment${listPost[i].idPost}"><button onclick="comment(${listPost[i].idPost})">comment</button>`
        }
        document.querySelector('#content').innerHTML = drawPost;
    }

    showListPost();


    function creatPost() {
        let id;
        if (listPost.length == 0) {
            id = 1
        } else {
            id = listPost[listPost.length - 1].idPost + 1;
        }
        let post = new Post();
        post.idPost = id;
        post.imgPost = getImage();
        post.title = document.getElementById('conten').value;
        post.idUser = idUser;
        listPost.push(post);
        localStorage.setItem('list_video', JSON.stringify(listPost));
        showListPost();
    }

    // let count = 0
    //
    // function like(id) {
    //     count = count + 1;
    //     document.querySelector('.like').innerHTML = count + '' + 'like';
    // }

    function comment(id) {
        let comment1 = document.getElementById(`comment${id}`).value;
        for (let i = 0; i < listPost.length; i++) {
            if (listPost[i].idPost === id) {
                listPost[i].listCM.push({
                    'user': currentUser,
                    'contentCM': comment1
                })
                localStorage.setItem('list_video', JSON.stringify(listPost))
                break;
            }

        }
        showListPost()
    }

    function dieuHuong() {
        location.href = "sign.html"
    }

    function dieuHuonglog() {
        location.href = 'log.html'
    }

</script>
<script>
    let listAvatar = JSON.parse(localStorage.getItem('list_avatar'));
    if (listAvatar == null) {
        listAvatar = [];
    }

    function showlistAvatar() {
        let drawA = '';

        for (let i = 0; i < listAvatar.length; i++) {
            drawA += `<img src="${listAvatar[i].avatarImg}">`
        }
        document.querySelector('#postAvatar').innerHTML = drawA;
    }
    listAvatar.shift();
    showlistAvatar();


    function chuyenHuong() {
        location.href = 'userProfile.html'
    }

</script>
<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBBQ1lFZ-PLx4_zAJAiPEIAqJ6hnkvbMms",
        authDomain: "tiktok-31159.firebaseapp.com",
        projectId: "tiktok-31159",
        storageBucket: "tiktok-31159.appspot.com",
        messagingSenderId: "912431147607",
        appId: "1:912431147607:web:7ed67c41d93cb4a8e75112"
    };
    firebase.initializeApp(firebaseConfig);
    var image = '';
    var fbBucketName = 'images';

    // get elements
    var uploader = document.getElementById('uploader');
    var fileButton = document.getElementById('fileButton');

    // listen for file selection
    fileButton.addEventListener('change', function (e) {

        // what happened
        console.log('file upload event', e);

        // get file
        var file = e.target.files[0];

        // create a storage ref
        var storageRef = firebase.storage().ref(`${fbBucketName}/${file.name}`);

        // upload file
        var uploadTask = storageRef.put(file);


        // update progress bar
        uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED, // or 'state_changed'
            function (snapshot) {
                // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded
                var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                uploader.value = progress;
                console.log('Upload is ' + progress + '% done');
                switch (snapshot.state) {
                    case firebase.storage.TaskState.PAUSED: // or 'paused'
                        console.log('Upload is paused');
                        break;
                    case firebase.storage.TaskState.RUNNING: // or 'running'
                        console.log('Upload is running');
                        break;
                }
            }, function (error) {


                switch (error.code) {
                    case 'storage/unauthorized':

                        break;

                    case 'storage/canceled':

                        break;

                    case 'storage/unknown':

                        break;
                }
            }, function () {

                var downloadURL = uploadTask.snapshot.downloadURL;
                image = downloadURL;
                console.log('downloadURL ===>', image);
                let imgElement = document.createElement("img");
                imgElement.src = downloadURL
                console.log('pic ==', image)
            });

    });

    function getImage() {
        return image;
    }
</script>


</html>